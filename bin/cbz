#!/usr/bin/env bash

v_dir="${1}"
v_temp_dir=$(mktemp -d -p "${v_dir%/*}" temp_dir.XXXXXXXXXX)
v_cbz="${v_dir%/*}/${v_dir##*/}.cbz"
v_num="1"
v_seq=$(ls -1 "${v_dir}" | wc -l)
v_seq=$(seq -w "${v_seq}")

cp "${v_dir}/"* "${v_temp_dir}"

for i in $(ls -v1 "${v_temp_dir}"); do
  mv -f "${v_temp_dir}/${i}" "${v_temp_dir}/"$(echo "${v_seq}" | cut -d $'\n' -f "${v_num}")".${i##*.}"
  ((v_num++))
done

7z a -mx=0 -tzip "${v_cbz}" "${v_temp_dir}/"*

rm -rf "${v_temp_dir}"
